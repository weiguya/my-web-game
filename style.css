// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyCCZoEDlhBkixk09r7pMTK405cTcLCNwDM",
  authDomain: "simple-chat-room-c51e7.firebaseapp.com",
  databaseURL: "https://simple-chat-room-c51e7-default-rtdb.firebaseio.com",
  projectId: "simple-chat-room-c51e7",
  storageBucket: "simple-chat-room-c51e7.firebasestorage.app",
  messagingSenderId: "1079302562257",
  appId: "1:1079302562257:web:46acb19989a7529dd840f0",
  measurementId: "G-32LY5EPZTV"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// DOM Elements
const nameContainer = document.getElementById('name-container');
const chatContainer = document.getElementById('chat-container');
const chatBox = document.getElementById('chat-box');
const playerNameInput = document.getElementById('player-name');
const joinChatBtn = document.getElementById('join-chat-btn');
const chatInput = document.getElementById('chat-input');
const sendBtn = document.getElementById('send-btn');

let playerName = "";

// Join Chat
joinChatBtn.addEventListener('click', () => {
  const name = playerNameInput.value.trim();
  if (!name) {
    alert("Please enter your name.");
    return;
  }
  playerName = name;
  nameContainer.style.display = 'none';
  chatContainer.style.display = 'block';
  listenForMessages();
});

// Send Message
sendBtn.addEventListener('click', () => {
  const message = chatInput.value.trim();
  if (!message) return;
  
  const chatRef = db.ref('chat-room');
  const newMessage = {
    sender: playerName,
    message: message,
    timestamp: new Date().toISOString()
  };

  chatRef.push(newMessage);
  chatInput.value = '';
});

// Listen for Messages
function listenForMessages() {
  const chatRef = db.ref('chat-room');
  chatRef.on('value', (snapshot) => {
    const messages = snapshot.val();
    chatBox.innerHTML = ''; // Clear chat box

    for (const key in messages) {
      const { sender, message } = messages[key];
      const messageElement = document.createElement('div');
      messageElement.textContent = `${sender}: ${message}`;
      chatBox.appendChild(messageElement);
    }

    chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to bottom
  });
}
